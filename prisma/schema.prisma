generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Board {
  id          String    @id @default(cuid())
  key         String    @unique
  name        String
  description String?
  order       Int       @default(0)
  isVisible   Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime @updatedAt
  slug        String
  menuItemId  String
  deletedAt   DateTime?
  isDeleted   Boolean   @default(false)
  // 메인 페이지 노출 설정
  showOnHome     Boolean  @default(false)
  homeItemCount  Int      @default(5)
  menuItem    MenuItem  @relation(fields: [menuItemId], references: [id], onDelete: Cascade)
  posts       Post[]    @relation("posts")

  @@unique([menuItemId, slug])
}

model Category {
  id              String     @id @default(cuid())
  name            String
  slug            String     @unique
  description     String?
  order           Int        @default(0)
  isVisible       Boolean    @default(true)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime @updatedAt
  requiresAuth    Boolean    @default(false)
  thumbnailUrl    String?
  cardViewCount   Int        @default(0)
  cardViewEnabled Boolean    @default(true)
  displayOrder    String     @default("card")
  listViewCount   Int        @default(10)
  listViewEnabled Boolean    @default(false)
  cardViewLabel   String?
  listViewLabel   String?
  // 콘텐츠 날짜 표시 설정
  showDate        Boolean    @default(true)
  // 메인 페이지 노출 설정
  showOnHome      Boolean    @default(false)
  homeItemCount   Int        @default(3)
  contents        Content[]  @relation("categoryRef")
  menuItems       MenuItem[]
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  postId    String
  authorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  author    User     @relation(fields: [authorId], references: [id])
  post      Post     @relation("comments", fields: [postId], references: [id], onDelete: Cascade)
}

model Content {
  id              String    @id @default(cuid())
  title           String
  content         String
  imageUrl        String?
  price           String?
  isVisible       Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  contentMarkdown String?
  categoryId      String
  contentType     String    @default("RICH")
  htmlContent     String?
  deletedAt       DateTime?
  isDeleted       Boolean   @default(false)
  categoryRef     Category  @relation("categoryRef", fields: [categoryId], references: [id])
}

model Menu {
  id        String     @id @default(cuid())
  key       String     @unique
  name      String
  createdAt DateTime   @default(now())
  updatedAt DateTime @updatedAt
  items     MenuItem[] @relation("items")
}

model MenuItem {
  id               String       @id @default(cuid())
  menuId           String
  label            String
  href             String
  order            Int          @default(0)
  isVisible        Boolean      @default(true)
  isExternal       Boolean      @default(false)
  openInNew        Boolean      @default(false)
  requiresAuth     Boolean      @default(false)
  badgeText        String?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  linkType         MenuLinkType @default(category)
  linkedCategoryId String?
  thumbnailUrl     String?
  boards           Board[]
  linkedCategory   Category?    @relation(fields: [linkedCategoryId], references: [id])
  menu             Menu         @relation("items", fields: [menuId], references: [id], onDelete: Cascade)

  @@index([menuId, order])
}

model Post {
  id              String           @id @default(cuid())
  title           String
  content         String
  authorId        String
  viewCount       Int              @default(0)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime @updatedAt
  contentMarkdown String?
  isPinned        Boolean          @default(false)
  isSecret        Boolean          @default(false)
  likeCount       Int              @default(0)
  scrapCount      Int              @default(0)
  boardId         String
  comments        Comment[]        @relation("comments")
  author          User             @relation(fields: [authorId], references: [id])
  board           Board            @relation("posts", fields: [boardId], references: [id])
  attachments     PostAttachment[] @relation("attachments")
  likes           PostLike[]       @relation("likes")
  scraps          PostScrap[]      @relation("scraps")
}

model PostAttachment {
  id        String   @id @default(cuid())
  postId    String
  url       String
  name      String?
  type      String?
  size      Int?
  createdAt DateTime @default(now())
  post      Post     @relation("attachments", fields: [postId], references: [id], onDelete: Cascade)
}

model PostLike {
  id        String   @id @default(cuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())
  post      Post     @relation("likes", fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
}

model PostScrap {
  id        String   @id @default(cuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())
  post      Post     @relation("scraps", fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
}

model SiteSettings {
  id                     String   @id @default(cuid())
  key                    String   @unique
  footerEnabled          Boolean  @default(true)
  showTerms              Boolean  @default(true)
  showPrivacy            Boolean  @default(true)
  showBusinessInfo       Boolean  @default(true)
  socialLinks            Json?
  showSocials            Boolean  @default(true)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  businessLines          Json?
  privacyContent         String?
  privacyContentMarkdown String?
  termsContent           String?
  termsContentMarkdown   String?
  siteLogoUrl            String?
  siteName               String?
  copyrightText          String?
  showCopyright          Boolean  @default(true)
  communityEnabled       Boolean  @default(true)
  siteTagline            String?
  siteDescription        String?
  ogImageUrl             String?
  faviconUrl             String?
  headerStyle            String   @default("classic")
  headerScrollEffect     Boolean  @default(true)
  socialIconStyle        String   @default("branded")
  showSocialLabels       Boolean  @default(false)
  socialAlignment        String   @default("center")
}

model User {
  id         String      @id @default(cuid())
  email      String      @unique
  password   String
  name       String?
  role       String      @default("USER")
  isApproved Boolean     @default(false)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  comments   Comment[]
  posts      Post[]
  likes      PostLike[]
  scraps     PostScrap[]
}

enum MenuLinkType {
  category
  community
  external
}
