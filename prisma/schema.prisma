generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum MenuLinkType {
  category
  community
  external
}

model User {
  id         String      @id @default(cuid())
  email      String      @unique
  password   String
  name       String?
  role       String      @default("USER")
  isApproved Boolean     @default(false)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  comments   Comment[]
  posts      Post[]
  postLikes  PostLike[]
  postScraps PostScrap[]
}

model Product {
  id              String    @id @default(cuid())
  title           String
  content         String
  imageUrl        String?
  price           String?
  isVisible       Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  contentMarkdown String?
  categoryId      String
  contentType     String    @default("RICH")
  htmlContent     String?
  categoryRef     Category  @relation(fields: [categoryId], references: [id])
}

model Post {
  id              String           @id @default(cuid())
  title           String
  content         String
  boardId         String
  authorId        String
  viewCount       Int              @default(0)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  contentMarkdown String?
  isPinned        Boolean          @default(false)
  isSecret        Boolean          @default(false)
  likeCount       Int              @default(0)
  scrapCount      Int              @default(0)
  comments        Comment[]
  board           Board            @relation(fields: [boardId], references: [id])
  author          User             @relation(fields: [authorId], references: [id])
  attachments     PostAttachment[]
  likes           PostLike[]
  scraps          PostScrap[]
}

model PostAttachment {
  id        String   @id @default(cuid())
  postId    String
  url       String
  name      String?
  type      String?
  size      Int?
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
}

model PostLike {
  id        String   @id @default(cuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
}

model PostScrap {
  id        String   @id @default(cuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  postId    String
  authorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  author    User     @relation(fields: [authorId], references: [id])
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
}

model Menu {
  id        String     @id @default(cuid())
  key       String     @unique
  name      String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  items     MenuItem[]
}

model MenuItem {
  id           String   @id @default(cuid())
  menuId       String
  label        String
  href         String
  order        Int      @default(0)
  isVisible    Boolean  @default(true)
  isExternal   Boolean  @default(false)
  openInNew    Boolean  @default(false)
  requiresAuth Boolean  @default(false)
  badgeText    String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  linkType     MenuLinkType @default(category)
  linkedCategoryId String?
  menu         Menu     @relation(fields: [menuId], references: [id], onDelete: Cascade)
  boards       Board[]
  linkedCategory Category? @relation(fields: [linkedCategoryId], references: [id])

  @@index([menuId, order])
}

model SiteSettings {
  id                     String   @id @default(cuid())
  key                    String   @unique
  footerEnabled          Boolean  @default(true)
  showTerms              Boolean  @default(true)
  showPrivacy            Boolean  @default(true)
  showBusinessInfo       Boolean  @default(true)
  socialLinks            Json?
  showSocials            Boolean  @default(true)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  businessLines          Json?
  privacyContent         String?
  privacyContentMarkdown String?
  termsContent           String?
  termsContentMarkdown   String?
  siteLogoUrl            String?
  siteName               String?
  siteTagline            String?
  siteDescription        String?
  ogImageUrl             String?
  faviconUrl             String?
  copyrightText          String?
  showCopyright          Boolean  @default(true)
  communityEnabled       Boolean  @default(true)
}

model Category {
  id          String    @id @default(cuid())
  name        String
  slug        String    @unique
  description String?
  order       Int       @default(0)
  isVisible   Boolean   @default(true)
  requiresAuth Boolean  @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]
  menuItems   MenuItem[]
}

model Board {
  id          String   @id @default(cuid())
  key         String   @unique
  slug        String
  menuItemId  String
  menuItem    MenuItem @relation(fields: [menuItemId], references: [id], onDelete: Cascade)
  name        String
  description String?
  order       Int      @default(0)
  isVisible   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  posts       Post[]

  @@unique([menuItemId, slug])
}
